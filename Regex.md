# 정규 표현식(Regular Expression)
서론
---
> Regex는 텍스트를 일정한 규칙을 담은 단어로 검색하는데 사용할 수 있습니다.  
[위키피디아](https://ko.wikipedia.org/wiki/%EC%A0%95%EA%B7%9C_%ED%91%9C%ED%98%84%EC%8B%9D)에서 정규표현식의 문법에 대해 설명이 있지만 
내용이 실 사용과 동 떨어진 부분이 많기에 따로 쓰게 되었습니다.
현재 Regex는 1957년 발명되면서 현재 다양한 형태로 문법이 확장 되었으며 다음 4가지의 주요 확장된 버전이 있습니다.
> * PCRE(PHP에서 사용)
>* Regex(JavaScript 버전)
>* Regex(Python 버전)
>* Regex(Golang 버전)
>
> 이 강좌에서는 Python 버전을 기준으로 작성하였습니다. 일부 문법은 다른 버전에서 유효하지 않을 수 있습니다.

||개요||
:---:|:---:|:---:
[문자토큰](#문자토큰)|[문자클래스](#문자클래스)|[수량접미사](#수량접미사)
[그룹](#그룹)|[플래그](#플래그)|[자주쓰는정규식](#자주쓰는정규식)

- [Regex 디버거](https://regex101.com/)
- [Regex 시각화](https://regexper.com/)


문자토큰
---

### 단사 토큰
토큰|범위
---|---
\n|뉴라인 문자
\r|캐리지 리턴 문자
\t|탭 문자
\v|수직 탭 문자
\f|폼 피드 문자
\0|Null 문자
[\b]|백스페이스 문자
\xYY|YY(16진수)에 해당하는 유니코드를 가진 문자
\ddd|ddd(8진수)에 해당하는 유니코드를 가진 문자
\\ | 다음 문자를 문법으로 인식하지 않도록 함.<br>(달러 표시를 찾으려면 \\$를 써야함)|

### 전사 토큰
토큰|범위
---|---
.|(\n을 제외한)모든 문자
^|문자열의 시작 위치<br>(플래그 m이 설정되면 **각 줄의 시작 위치**)
$|문자열의 끝 위치<br>(플래그 m이 설정되면 **각 줄의 끝 위치**)
\A|문자열의 시작 위치
\Z|문자열의 끝 위치

### 여집합이 있는 토큰
토큰|여집합 토큰|토큰의 범위
---|---|---
\s|\S|공백문자(\r, \n, \t, \f, \v,스페이스)
\d|\D|숫자(0, 1, 2, 3, 4, 5, 6, 7, 8, 9)
\w|\W|글자(특수문자를 제외한 모든 단일 문자어<br>(특수문자를 제외한 모든 단일 문자)
\b|\B|단어(연속된 글자)들의 경계 위치

문자클래스
---

검색어|해석
---|---
[abc]|a, b, c 중 하나에 해당되는 문자
[^abc]|[abc]에 해당하지 않는 문자
[a-z]|a~z 범위에 포함되는 문자
[a-zA-Z]|a~z, A~Z 범위들에 포함되는 문자
[0-9만억조경]|0-9 범위나 만, 억, 조, 경 중 하나라도 해당하는 문자

수량접미사
---

접미사|해석
---|---
?|해당하는 패턴이 0개 혹은 1개
*|해당하는 패턴이 0개 이상
+|해당하는 패턴이 1개 이상
{n}|해당하는 패턴이 n개
{n,}|해당하는 패턴이 n개 이상
{,n}|해당하는 패턴이 n개 이하
{m,n}|해당하는 패턴이 m개 이상, n개 이하

### 수량 선정 접미사
> 기본적으로 수량 접미사를 사용하였을 때
> 해당하는 패턴의 갯수를 최대한 늘리려고 합니다.
> 그러나 수량 접미사의 끝에 ?(수량 선정 접미사)를 붙히면
> 해당하는 패턴의 갯수를 최소한으로 줄입니다.

* 문자열
```
123456
```
검색어|검색결과|검색어(수량 선정 접미사)|검색결과(수량 선정 접미사)
---|---|---|---
\d|`1`, `2`, `3`, `4`, `5`, `6`|수량접미사로 해석됨|
\d*|`123456`,`문자열의 끝 위치`|\d*?|`1의 위치`, `2의 위치`, `3의 위치`,<br>`4의 위치`, `5의 위치`, `6의 위치` 
\d+|`123456`|\d+?|`1`, `2`, `3`, `4`, `5`, `6`
\d{3}|`123`, `456`|\d{3}?|*변화 없음*
\d{4,}|`123456`|\d{4,}?|`1234`

그룹
---

> 그룹은 검색어를 묶어서 그룹 단위로 검색어를 구성할 수 있게 해줍니다.  
> 정규식 검색 할 때 전체 검색 결과 뿐만 아니라 그룹 단위의 검색 결과도 볼 수 있습니다.

### 일반 문법

검색어|해석
---|---
지도|지도를 검색함
(지도)|지도를 검색함(**그룹 검색 결과에 포함됨**)
(지도\|망원경)|지도나 망원경중 하나에 해당하는 것을 검색함
(?:망원경)|망원경을 검색함(**그룹 검색 결과에 포함되지 않음**)
(?#주석)|주석을 달기위해 사용됨
(?i)|대소문자 구분 플래그를 검색 도중에 설정함
(?-i)|대소문자 구분 플래그를 검색 도중에 해제함
(?P\<food\>민트\|초코)|민트나 초코 중 하나에 해당하는 것을 검색함(**검색 결과를 "food"라는 key로 찾을 수 있게함**)


### 심화 문법
#### 서브패턴 ```(?P=name)```
* 검색어
```regex
<(?P<tag>\w+)>.*?</(?P=tag)>
```
* 문자열
```
<div></div>
<table></table>
<h3></h4>
```
* 검색결과
  1. Full match: ```<div></div>```
     * Group \`tag\`: ```div```
  2. Full match: ```<table></table>```
  	 * Group \`tag\`: ```table```
> 이전에 사용하였던 그룹의 검색 결과를 사용할 수 있는 문법입니다.  
> 특정한 문구가 반복 사용 되야 한다면 이 문법을 사용할 수 있습니다.

#### 조건적패턴 `(?(n))`, `(?P\<name\>)```
* 검색어
```regex
(?P<month>\d+월 )?(?(month)(?<day>\d+일)|\w요일)
```
* 문자열
```
목요일
수요일
화요일
3월 2일
5월 7일
7월 9일
```
* 검색결과
  1. Full match: ```목요일```
  2. Full match: ```수요일```
  3. Full match: ```화요일```
  4. Full match: ```3월 2일```
  	 * Group \`tag\`: ```3월```
  	 * Group \`tag\`: ```2일```
  5. Full match: ```5월 7일```
  	 * Group \`tag\`: ```5월```
  	 * Group \`tag\`: ```7일```
  6. Full match: ```7월 9일```
  	 * Group \`tag\`: ```7월```
  	 * Group \`tag\`: ```9일```
> 이전에 사용하였던 그룹의 검색 결과에 따라 분기를 두어  
> 다른 검색어를 사용할 수 있게 해주는 문법입니다.  
> 검색어에 분기가 필요할 때 사용할 수 있습니다.

#### 단언패턴
> 원하는 패턴의 지금 검색 위치의 전/후방에 존재하는지 확인하는 패턴입니다.
> 단언 패턴 사용으로 검색 위치가 변경되지 않습니다.
* 문자열
```
엄준식 회장
서준식 반장
박준식 부반장
김준식
```
##### 후방 긍정 단언```(?=pattern)```
* 검색어 
```regex
\w{3}(?= 반장)
```
* 검색결과
```
서준식
```
> 후방에 해당하는 패턴이 있는지 단언합니다.  

##### 후방 부정 단언 ```(?!pattern)```
* 검색어
```regex
^\w{3}(?! .?반장)
```
* 검색결과
```
엄준식
김준식
```
> 후방에 해당하는 패턴이 없는지 단언합니다.  

##### 전방 긍정 단언 ```(?<=pattern)```
* 검색어
```regex
(?<=엄준식 ).*
```
* 검색결과
```
회장
```
> 전방에 해당하는 패턴이 없는지 단언합니다.  

##### 전방 부정 단언 ```(?<=pattern)```
* 검색어
```regex
(?<!엄준식 )(?<= )\b\w+
```
* 검색결과
```
반장
부반장
서기
```
> 전방에 해당하는 패턴이 없는지 단언합니다.  

플래그
---

플래그|효과
---|---
g|검색 결과가 여러개로 나오는 것을 허용함.
m|^, $가 각 줄 시작과 끝을 가르키도록 함.
i|대소문자 구분을 하지 않음.
x|검색어에서 공백 문자를 무시하고 #문자 이후 문자를 주석으로 처리 하도록 함.
s|. 토큰에 \도 포함함
u|유니코드 지원(Python 2 해당)
a|\w의 범위를 아스키 단어로 제한함


자주쓰는정규식
---
### 닉네임
* 검색어
```regex
^[a-z0-9_-]{3, 16}$
```
* 해설
![alt text](/img/nick.png)
  * `^` 문자열의 시작
  * `[a-z0-9_-]`a 부터 z, 0 부터 9, 언더대쉬, 대쉬를 포함하는 문자클래스
  * `{3, 16}` 위 패턴을 3개에서 16개까지 최대한 검색
  * `$` 문자열의 끝
### 전화번호
* 검색어
```regex
^(\+\d{1,3}\d{2}-\d{3,4}-\d{4}|0\d{2}-\d{3,4}-\d{4})$
```
* 해설
![alt text](/img/phone.png)
  * `^` 문자열의 시작
  * `(\+\d{1,3}\d{2}-\d{3,4}-\d{4}|0\d{2}-\d{3,4}-\d{4})`
    * `\+` + 문자
      * `\d` 숫자
      * `{1,3}` 1개에서 3개까지 최대한 검색
      * `\d` 숫자
      * `{2}` 2개 검색
      * `-` - 문자
      * `\d` 숫자
      * `{3,4}` 3개에서 4개까지 최대한 검색
      * `-` - 문자
      * `\d` 숫자
      * `{4}` 4개 검색
    * `|` 위 패턴 혹은 아래 패턴
      * `0` 0 문자
      * `\d` 숫자
      * `{2}` 2개 검색
      * `-` - 문자
      * `\d` 숫자
      * `{3,4}` 3개에서 4개 검색
      * `-` - 문자
      * `\d` 숫자
      * `{4}` 4개 검색
  * `$` 문자열의 끝
 
### 이메일
* 검색어
```regex
^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$
```
* 해설
![alt text](/img/email.png)
  * `^` 문자열의 시작
  * `([a-z0-9_\.-]+)`
    * `[a-z0-9_\.-]` a 부터 z, 0 부터 9, 언더대시, 백슬래시, 대시를 포함하는 문자클래스
    * `+` 위 패턴을 1개 이상 검색
  * `@` @ 문자
  * `([\da-z\.-]+)`
    * `[\da-z\.-]` 숫자, a-z, 백슬래시, 온점, 대시를 포함하는 문자클래스
    * `+` 위 패턴을 1개 이상 검색
  * `\.` . 문자
  * `([a-z\.]{2,6})`
    * `[a-z\.]` a 부터 z, 온점을 포함하는 문자 클래스
    * `{2,6}` 위 패턴을 2개에서 6개까지 최대한 검색
  * `$` 문자열의 끝

### URL
* 검색어
```regex
^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)\/?$
```
* 해설
![alt text](/img/url.png)
  * `^` 문자열의 시작
  * `(https?:\/\/)`
    * `h` h 문자
    * `t` t 문자
    * `t` t 문자
    * `p` p 문자
    * `s` s 문자
    * `?` 위 패턴을 1개 혹은 0개 검색
    * `:` : 문자
    * `\/` / 문자
    * `\/` / 문
  * `?` 위 패턴을 1개 혹은 0개 검색
  * `([\da-z\.-]+)`
    * `[\da-z\.-]` 숫자, a 부터 z, 온점, 대쉬를 포함하는 문자클래스
    * `+` 위 패턴이 1개 이상 최대한 검색
  * `\.` 온점 문자
  * `([a-z\.]{2,6})`
    * `[a-z\.]` a 부터 z, 온점 문자를 포함하는 문자클래스
    * `{2,6}` 위 패턴을 2개 에서 6개까지 최대한 검색
  * `([\/\w \.-]*)`
    * `[\/\w \.-]` 백슬래쉬, 글자, 스페이스, 온점, 대쉬를 포함하는 문자클래스
    * `*` 위 패턴을 0개 이상 최대한 검색
  * `\/` 백슬래시 문자
  * `?` 위 패턴을 1개 혹은 0개 검색
  * `$` 문자열의 끝
